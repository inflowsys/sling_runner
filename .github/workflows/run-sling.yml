name: Run Sling Replication

on:
  workflow_dispatch:
  schedule:
    # Run daily at 2:00 AM UTC (adjust cron schedule as needed)
    # Format: minute hour day-of-month month day-of-week
    - cron: '0 2 * * *'

jobs:
  run-sling:
    runs-on: self-hosted
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Verify Python installation
        run: python --version
      
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"
      
      - name: Install dependencies
        run: uv sync
      
      - name: Run sling_run.py
        env:
          TAXI_PG_PASSWORD: ${{ secrets.TAXI_PG_PASSWORD }}
          SLING_CLI_TOKEN: ${{ secrets.SLING_CLI_TOKEN }}
          SLING_DISABLE_TELEMETRY: true
        run: uv run python sling_run.py

